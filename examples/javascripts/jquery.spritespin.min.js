(function($,undefined){var methods={init:function(options){var settings={width:640,height:480,frames:36,frame:0,animate:false,loop:false,speed:36,reverse:false,image:"images/spritespin.jpg",onFrameChanged:undefined,slider:undefined,interactive:true}
options=(options||{});$.extend(settings,options);return this.each(function(){var $this=$(this);var data=$this.data('spritespin');if(!data){$(this).disableSelection();$(this).data('spritespin',{target:$this,settings:settings,animation:null,touchable:(/iphone|ipod|ipad|android/i).test(navigator.userAgent)});data=$this.data('spritespin');}else{$.extend(data.settings,options);}
x=-data.settings.frame*data.settings.width;$this.css({width:data.settings.width+"px",height:data.settings.height+"px","background-image":"url('"+data.settings.image+"')","background-repeat":"no-repeat","background-position":x+"px 0px"});if(data.settings.slider!=undefined){data.settings.slider.slider({value:data.settings.frame,min:0,max:(data.settings.frames)-1,step:1,slide:function(event,ui){methods.animate.apply($this,[false]);methods.update.apply($this,[ui.value]);},});}
if(data.settings.animate){methods.animate.apply($this,[data.settings.animate,data.settings.loop]);}
$this.unbind('.spritespin');if(settings.interactive){$this.bind('mousemove.spritespin',events.onMouseMove);$this.bind('mousedown.spritespin',events.onMouseDown);$this.bind('mouseup.spritespin',events.onMouseUp);$this.bind('mouseleave.spritespin',events.onMouseLeave);}
if(data.touchable&&settings.interactive){$this.bind('touchstart.spritespin',events.onTouchStart);$this.bind('touchend.spritespin',events.onTouchEnd);$this.bind('touchcancel.spritespin',events.onTouchEnd);$this.bind('touchmove.spritespin',events.onTouchMove);}});},destroy:function(){return this.each(function(){var $this=$(this);data=$this.data('spritespin');$this.unbind('.spritespin');$this.removeData('spritespin');});},update:function(frame){return this.each(function(){var $this=$(this);data=$this.data('spritespin');settings=data.settings;oldFrame=data.settings.frame;if(typeof(frame)=='undefined'){step=settings.reverse?-1:1
settings.frame=(settings.frame+step)%settings.frames;}else{settings.frame=frame%settings.frames;}
while(settings.frame<0){settings.frame+=settings.frames;}
if(oldFrame!=settings.frame){x=-settings.frame*settings.width;$this.css({"background-position":x+"px 0px"});if(settings.frame==0&&!settings.loop){methods.animate.apply($this,[false]);}
if(settings.slider!=undefined){settings.slider.slider("value",settings.frame);}
if(settings.onFrameChanged!=undefined){settings.onFrameChanged.apply($this,[settings.frame]);}}});},animate:function(animate,loop){if(animate==undefined){return $(this).data('spritespin').animation!=null;}else{return this.each(function(){var $this=$(this);data=$this.data('spritespin');settings=data.settings;if(typeof(loop)=="boolean"){settings.loop=loop;}
if(animate=="toggle"){animate=!settings.animate
settings.animate=animate;}else{settings.animate=animate;}
if(animate&&data.animation==null){data.animation=setInterval(function(){methods.update.apply($this,[]);},settings.speed);}else if(!animate&&data.animation!=null){clearInterval(data.animation);data.animation=null;}});}},frame:function(frame){if(frame==undefined){return $(this).data('spritespin').settings.frame;}else{return this.each(function(){methods.update.apply($(this),[frame]);});}},loop:function(value){if(value==undefined){return $(this).data('spritespin').settings.loop;}else{return this.each(function(){var $this=$(this);data=$this.data('spritespin');methods.animate.apply($(this),[data.settings.animate,value]);});}},};var events={onMouseDown:function(){var $this=$(this);data=$this.data('spritespin');data.dragging=true;},onMouseUp:function(e){var $this=$(this);data=$this.data('spritespin');data.dragging=false;},onMouseLeave:function(e){var $this=$(this);data=$this.data('spritespin');data.dragging=false;},onMouseMove:function(e){var $this=$(this);data=$this.data('spritespin');if(data.dragging&&typeof(data.oldMouseX)!="undefined"){d=data.oldMouseX-e.pageX;if(d>0){methods.update.apply($this,[data.settings.frame+1]);}else if(d<0){methods.update.apply($this,[data.settings.frame-1]);}
methods.animate.apply($(this),[false]);}
data.oldMouseX=e.pageX;data.oldMouseY=e.pageY;},onTouchStart:function(e){var $this=$(this);data=$this.data('spritespin');methods.animate.apply($(this),[false]);data.dragging=true;},onTouchMove:function(e){var $this=$(this);data=$this.data('spritespin');if(data.dragging&&typeof(data.oldMouseX)!="undefined"){d=data.oldMouseX-e.pageX;if(d>0){methods.update.apply($this,[data.settings.frame+1]);}else if(d<0){methods.update.apply($this,[data.settings.frame-1]);}}
data.oldMouseX=e.touches[0].clientX;data.oldMouseY=e.touches[0].clientY;},onTouchEnd:function(e){var $this=$(this);data=$this.data('spritespin');data.dragging=false;},};$.fn.spritespin=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof(method)==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.spritespin');}};})(jQuery);