(function(f,e){function j(b,a){this.callback=a;if(typeof b=="string")b=[b];this.nProcessed=this.nLoaded=0;this.aImages=[];this.nImages=b.length;for(var c=0;c<b.length;c++)this.preload(b[c])}f.fn.spritespin=function(b){if(i[b])return i[b].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof b==="object"||!b)return i.init.apply(this,arguments);else f.error("Method "+b+" does not exist on jQuery.spritespin")};var i={init:function(b){var a={offsetX:0,offsetY:0,width:e,height:e,frameStep:e,
frames:36,frame:0,animate:true,loop:false,loopFrame:0,frameTime:36,reverse:false,sense:1,slider:e,behavior:"drag",image:"images/spritespin.jpg",preloadText:"Loading",preloadBackground:e,preloadCSS:e,onFrame:e,onLoad:e};b=b||{};f.extend(a,b);return this.each(function(){var c=f(this),g=c.data("spritespin");if(g)f.extend(g.settings,b);else{c.attr("unselectable","on");c.data("spritespin",{target:c,settings:a,animation:null,frameTime:a.frameTime,touchable:/iphone|ipod|ipad|android/i.test(navigator.userAgent)});
g=c.data("spritespin")}k.reconfiger(c,g)})},destroy:function(){return this.each(function(){var b=f(this);data=b.data("spritespin");b.unbind(".spritespin");b.removeData("spritespin")})},update:function(b,a){return this.each(function(){data=f(this).data("spritespin");settings=data.settings;if(a!=e)settings.reverse=a;if(b==e)settings.frame+=settings.reverse?-1:1;else settings.frame=b;settings.frame=k.wrapValue(settings.frame,0,settings.frames);data.target.trigger("onFrame",data)})},animate:function(b,
a){return b==e?f(this).data("spritespin").animation!=null:this.each(function(){var c=f(this);data=c.data("spritespin");settings=data.settings;if(typeof a=="boolean")settings.loop=a;if(b=="toggle")b=!settings.animate;if((settings.animate=b)&&data.animation==null)data.animation=setInterval(function(){try{i.update.apply(c,[])}catch(g){}},data.frameTime);else if(!b&&data.animation!=null){clearInterval(data.animation);data.animation=null}})},frame:function(b){return b==e?f(this).data("spritespin").settings.frame:
this.each(function(){i.update.apply(f(this),[b])})},loop:function(b){return b==e?f(this).data("spritespin").settings.loop:this.each(function(){data=f(this).data("spritespin");i.animate.apply(f(this),[data.settings.animate,b])})}},k={reconfiger:function(b,a){k.blankBackground(b,a);k.preloadImages(b,a,function(){k.updateBackground(b,a);k.hookSlider(b,a);k.rebindEvents(b,a);a.settings.animate&&i.animate.apply(b,[a.settings.animate,a.settings.loop]);b.trigger("onLoad",a)})},wrapValue:function(b,a,c){for(;b>=
c;)b-=c;for(;b<a;)b+=c;return b},blankBackground:function(b,a){image="none";if(a.settings.preloadBackground!=e)image=["url('",a.settings.preloadBackground,"')"].join("");b.css({width:[a.settings.width,"px"].join(""),height:[a.settings.height,"px"].join(""),"background-image":image,"background-repeat":"repeat-x","background-position":"0px 0px"})},updateBackground:function(b){var a=b.data("spritespin"),c=a.settings.image,g=a.settings.offsetX,l=-a.settings.offsetY;if(typeof a.settings.image=="string")g-=
a.settings.frameStep!=e?a.settings.frame*a.settings.frameStep:a.settings.frame*a.settings.width;else c=a.settings.image[a.settings.frame];b.css({width:[a.settings.width,"px"].join(""),height:[a.settings.height,"px"].join(""),"background-image":["url('",c,"')"].join(""),"background-repeat":"repeat-x","background-position":[g,"px ",l,"px"].join("")})},hookSlider:function(b,a){a.settings.slider!=e&&a.settings.slider.slider({value:a.settings.frame,min:0,max:a.settings.frames-1,step:1,slide:function(c,
g){i.animate.apply(b,[false]);i.frame.apply(b,[g.value])}})},rebindEvents:function(b,a){b.unbind(".spritespin");b.bind("mousedown.spritespin",h[a.settings.behavior].mousedown);b.bind("mousemove.spritespin",h[a.settings.behavior].mousemove);b.bind("mouseup.spritespin",h[a.settings.behavior].mouseup);b.bind("mouseenter.spritespin",h[a.settings.behavior].mouseenter);b.bind("mouseover.spritespin",h[a.settings.behavior].mouseover);b.bind("mouseleave.spritespin",h[a.settings.behavior].mouseleave);b.bind("dblclick.spritespin",
h[a.settings.behavior].dblclick);b.bind("onFrame.spritespin",h[a.settings.behavior].onFrame);if(a.touchable){b.bind("touchstart.spritespin",h[a.settings.behavior].mousedown);b.bind("touchmove.spritespin",h[a.settings.behavior].mousemove);b.bind("touchend.spritespin",h[a.settings.behavior].mouseup);b.bind("touchcancel.spritespin",h[a.settings.behavior].mouseleave);b.bind("click.spritespin",h.prevent);b.bind("gesturestart.spritespin",h.prevent);b.bind("gesturechange.spritespin",h.prevent);b.bind("gestureend.spritespin",
h.prevent)}b.bind("mousedown.spritespin selectstart.spritespin",function(c){c.preventDefault()});b.bind("onFrame.spritespin",function(c,g){k.updateBackground(g.target,g);g.settings.frame==g.settings.loopFrame&&!g.settings.loop&&i.animate.apply(g.target,[false]);g.settings.slider!=e&&g.settings.slider.slider("value",g.settings.frame)});a.settings.onFrame!=e&&b.bind("onFrame.spritespin",a.settings.onFrame);a.settings.onLoad!=e&&b.bind("onLoad.spritespin",a.settings.onLoad)},preloadImages:function(b,
a,c){var g=f('<div class="preload"/>');b.find(".preload").length==0&&b.append(g);css=a.settings.preloadCSS||{};g.css(f.extend({width:a.settings.width,height:a.settings.height},css));g.hide().html(a.settings.preloadText).fadeIn(250,function(){new j(a.settings.image,function(){b.find(".preload").fadeOut(250,function(){f(this).detach()});c.apply([b,a])})})}};j.prototype.preload=function(b){var a=new Image;this.aImages.push(a);a.onload=j.prototype.onload;a.onerror=j.prototype.onerror;a.onabort=j.prototype.onabort;
a.oImagePreloader=this;a.bLoaded=false;a.src=b};j.prototype.onComplete=function(){this.nProcessed++;this.nProcessed==this.nImages&&this.callback(this.aImages,this.nLoaded)};j.prototype.onload=function(){this.bLoaded=true;this.oImagePreloader.nLoaded++;this.oImagePreloader.onComplete()};j.prototype.onerror=function(){this.bError=true;this.oImagePreloader.onComplete()};j.prototype.onabort=function(){this.bAbort=true;this.oImagePreloader.onComplete()};var h={prevent:function(b){b.cancelable&&b.preventDefault();
return false},helper:{storePoints:function(b,a){if(b.touches==e&&b.originalEvent!=e)b.touches=b.originalEvent.touches;a.oldX=a.currentX;a.oldY=a.currentY;if(b.touches!=e&&b.touches.length>0){a.currentX=b.touches[0].clientX;a.currentY=b.touches[0].clientY}else{a.currentX=b.clientX;a.currentY=b.clientY}if(a.startX==e||a.startY==e){a.startX=a.currentX;a.startY=a.currentY;a.clickframe=a.settings.frame}if(a.oldX==e||a.oldY==e){a.oldX=a.currentX;a.oldY=a.currentY}a.dX=a.currentX-a.startX;a.dY=a.currentY-
a.startY;a.ddX=a.currentX-a.oldX;a.ddY=a.currentY-a.oldY;return false},resetPoints:function(b,a){a.startX=e;a.startY=e;a.currentX=e;a.currentY=e;a.oldX=e;a.oldY=e;a.dX=0;a.dY=0;a.ddX=0;a.ddY=0},clamp:function(b,a,c){return b>c?c:b<a?a:b}},none:{mousedown:function(){return false},mousemove:function(){return false},mouseup:function(){return false},mouseenter:function(){return false},mouseover:function(){return false},mouseleave:function(){return false},dblclick:function(){return false},onFrame:function(){return false}},
spin:{mousedown:function(b){var a=f(this).data("spritespin");h.helper.storePoints(b,a);a.onDrag=true;return false},mousemove:function(b){var a=f(this),c=a.data("spritespin");if(c.onDrag){h.helper.storePoints(b,c);d=c.dX/c.settings.width;dFrame=d*c.settings.frames*c.settings.sense;frame=Math.round(c.clickframe+dFrame);i.update.apply(a,[frame]);i.animate.apply(a,[false]);if(c.ddX!=0){d=c.ddX/c.settings.width;dFrame=d*c.settings.frames*c.settings.sense;c.frameTime=c.settings.frameTime/dFrame;c.settings.reverse=
c.ddX<0}}return false},mouseup:function(){var b=f(this),a=b.data("spritespin");if(a.onDrag){a.onDrag=false;b.spritespin("animate",true)}return false},mouseenter:function(){return false},mouseover:function(){return false},mouseleave:function(){var b=f(this),a=b.data("spritespin");if(a.onDrag){a.onDrag=false;b.spritespin("animate",b.spritespin("animate"))}return false},dblclick:function(){f(this).spritespin("animate","toggle");return false},onFrame:function(b,a){if(a.ddX!=0){a.frameTime+=1;f(this).spritespin("animate",
false);a.frameTime<62&&f(this).spritespin("animate",true)}else f(this).spritespin("animate",false);return false}},drag:{mousedown:function(b){var a=f(this).data("spritespin");h.helper.storePoints(b,a);a.onDrag=true;return false},mousemove:function(b){var a=f(this),c=a.data("spritespin");if(c.onDrag){h.helper.storePoints(b,c);d=c.dX/c.settings.width;dFrame=d*c.settings.frames*c.settings.sense;frame=Math.round(c.clickframe+dFrame);i.update.apply(a,[frame]);i.animate.apply(f(this),[false])}return false},
mouseup:function(b){var a=f(this).data("spritespin");h.helper.resetPoints(b,a);return a.onDrag=false},mouseenter:function(){return false},mouseover:function(){return false},mouseleave:function(b){var a=f(this).data("spritespin");h.helper.resetPoints(b,a);return a.onDrag=false},dblclick:function(){var b=f(this);b.data("spritespin");b.spritespin("animate","toggle");return false},onFrame:function(){return false}}}})(jQuery);
